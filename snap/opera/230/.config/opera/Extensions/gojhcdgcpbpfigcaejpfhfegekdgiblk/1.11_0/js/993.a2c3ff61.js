"use strict";(self["webpackChunkdesktop_wallet"]=self["webpackChunkdesktop_wallet"]||[]).push([[993],{18027:function(t,e,s){s.d(e,{Z:function(){return g}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.activity&&t.token?s("div",{staticClass:"cursor-pointer flex my-3 p-4 rounded-lg t-activity_preview_item-transaction_detail",class:{"bg-dark-N16":!("pending"===t.txStatus),"bg-white":"pending"===t.txStatus,"text-spectrum-red":"failure"===t.txStatus,"text-white":!("pending"===t.txStatus),"text-dark-N16":"pending"===t.txStatus},on:{click:function(e){return t.openTransactionDetail(t.activity.hash)}}},[s("div",{staticClass:"mt-3 shrink-0"},[s("img",{class:[{"animate-spin":"pending"===t.txStatus}],attrs:{src:t.icons[t.txStatus]}})]),s("div",{staticClass:"flex items-center justify-between ml-4 truncate w-full"},[s("div",[s("div",{staticClass:"font-bold t-headline text-sm"},[t._v(t._s(t.headline))]),t.isRecipientOnly||t.isSenderOnly?t._e():s("div",{staticClass:"t-address text-dark-N77 text-sm",class:[{"text-spectrum-red":"failure"===t.txStatus}]},[t._v(" "+t._s(t.prettyAddress)+" ")])]),t.token?s("div",{staticClass:"text-end truncate"},[s("div",{staticClass:"flex font-bold justify-end text-sm"},[s("div",{staticClass:"max-w-[160px] pr-1 truncate",attrs:{title:t.value}},[t._v(" "+t._s(t.value)+" ")]),s("div",{staticClass:"max-w-[50px] min-w-[30px] truncate",attrs:{title:t.symbol}},[t._v(" "+t._s(t.symbol)+" ")])]),s("div",{staticClass:"text-dark-N77 text-sm",class:[{"text-spectrum-red":"failure"===t.txStatus}]},["pending"===t.txStatus?s("span",[t._v(t._s(t.$t("general.pending")+"..."))]):s("span",[t._v(t._s(t.timeOfActivity))])])]):t._e()])]):t._e()},a=[],n=s(500),r=s(35210),o=s(92496),l=s(20144),c=s(29652),h=s(4634),d=s(74597),u=s(27160),p=s(98180),v=l.Z.extend({name:"ActivityItem",props:{activity:{default:void 0,type:Object}},data(){const t=1e4;return{BASE_DELAY:t,delay:{bnb:t,btc:6e4,eth:t,matic:5e3},icons:{failure:s(98498),pending:s(71643),success:s(27176)},prettyAddress:`${this.$t("general.loading")}...`,timeOfActivity:"",token:void 0,txStatus:null,updateActivityInterval:null,updateTimeOfActivityInterval:null,updatingTxStatus:!1}},computed:{address(){const t=this.token?.chain.coinType||this.activity.chain.coinType;return this.$store.getters.accountsByCoinType[t].toLowerCase()},displayAddress(){if(this.isRecipientOnly)return this.recipient;if(this.isSenderOnly)return this.sender;switch(this.address){case this.recipient:return this.sender;case this.sender:return this.recipient;default:return this.address}},headline(){if(this.isRecipientOnly)return this.$t("general.received");if(this.isSenderOnly)return this.$t("general.sent");const t="failure"===this.txStatus;switch(this.address){case this.recipient:return t?this.$t("general.failedToReceive"):this.$t("general.receivedFrom");case this.sender:return t?this.$t("general.failedToSend"):this.$t("general.sentTo");default:return this.$t("general.unknown")}},isRecipientOnly(){return!(!this.recipient||this.sender)},isSenderOnly(){return!(this.recipient||!this.sender)},recipient(){return this.activity.to?.toLowerCase()??""},sender(){return this.activity.from?.toLowerCase()??""},status(){return this.txStatus?this.$t(`general.${this.txStatus}`):`${this.$t("general.loading")}...`},symbol(){const{token:t}=this,e="symbol"in t?t.symbol:t.contract.symbol;return e},type(){return this.activity.type},value(){let{token:t}=this;return t=Object.assign({},t,{balance:h.Z.formatNumber(this.activity.value)}),h.Z.formatNumber(p.Z.tokenDecimal(t))}},watch:{activity:{deep:!0,handler(){this.txStatus!==this.activity.status&&this.updateActivity()}},displayAddress(){this.updateAddress()}},beforeDestroy(){clearInterval(this.updateActivityInterval),clearInterval(this.updateTimeOfActivityInterval)},mounted(){this.updateActivity(),this.updateToken(),this.updateAddress(),this.updateTimeOfActivity()},methods:{assembleEvmActivity(t){const e=t.status?"success":"failure";return this.txStatus=e,{block:t.blockNumber,chain:this.activity.chain,contract:this.activity.contract??t.contractAddress,from:this.activity.from,hash:t.transactionHash,status:e,time:(new Date).getTime(),to:this.activity.to,type:this.activity.type,unindexed:!0,value:this.activity.value}},fromNow:u.ZP.fromNow,openTransactionDetail(t){const e=this.$store.getters.transactionDetailsUrl(t,this.token.chain);this.$platform.openNewTab(e)},async requestUpdatedTransactions(){if(await this.$store.dispatch("getTransactions",this.activity.chain),this.$store.getters.allTransactions.find((t=>t.hash===this.activity.hash))){const{chain:t,hash:e,type:s}=this.activity;this.$store.dispatch("clearPendingTransaction",e),this.$store.dispatch("getTokensForChain",{chain:t,type:s}),this.updateTimeOfActivity()}else{const t=this.delay[this.type]??this.BASE_DELAY;setTimeout((()=>this.requestUpdatedTransactions()),t)}},async resolveEnsAddress(){try{this.prettyAddress=await this.$ens.resolveAddress(this.displayAddress)}catch(t){}},updateActivity(){if(this.txStatus=this.activity.status,"pending"!==this.txStatus||this.updateActivityInterval){if((0,r.ij)(this.activity.chain)){const t=-1;this.txStatus=this.activity.block===t?"failure":"success"}}else{this.$nextTick((()=>this.updateTxStatus()));const t=this.delay[this.type]??this.BASE_DELAY;this.updateActivityInterval=window.setInterval(this.updateTxStatus,t)}},updateAddress(){this.prettyAddress=d.Z.elideAddress(this.displayAddress),this.resolveEnsAddress()},updateTimeOfActivity(t){clearInterval(this.updateTimeOfActivityInterval);const e=()=>{const e=(new Date).getTime(),{time:s}=this.activity;if(!t&&e-s>=u.EB)return this.updateTimeOfActivity(u.EB);this.timeOfActivity="pending"===this.txStatus?"":this.fromNow(e,s)};e(),this.updateTimeOfActivityInterval=window.setInterval(e,t??u.sh)},async updateToken(){const{contract:t,chain:e,type:s}=this.activity;if(p.Z.isNativeTokenType(s)?this.token=this.$store.getters.matchingNativeToken(s):this.token=this.$store.getters.getTokenViaSerializedKey(t,e),!this.token&&(0,r.cA)(e)){const s=await((0,c.Z)(e).getTokenInfo?.(t));s&&(this.token=p.Z.makeEvmToken(s,e))}},async updateTxStatus(){if(this.updatingTxStatus)return;if(this.updatingTxStatus=!0,"pending"!==this.txStatus)return clearInterval(this.updateActivityInterval),void(this.updatingTxStatus=!1);const t=n.B1.find((t=>(0,r.F2)(t.chain,this.activity.chain)));if(t?.rpcUrls?.length){const[e]=t.rpcUrls,[s]=e.split("//"),i=new Map([["https:","JsonRpcProvider"],["wss:","WebSocketProvider"]]),a=i.get(s),n=new o[a](e),r=await n.waitForTransaction(this.activity.hash);"status"in r&&(clearInterval(this.updateActivityInterval),this.$store.dispatch("clearPendingTransaction",this.activity.hash),this.$store.dispatch("addTransaction",{chain:this.activity.chain,tx:this.assembleEvmActivity(r)}))}else await this.$store.dispatch("getTransactions",this.activity.chain);this.updatingTxStatus=!1}}}),y=v,m=s(1001),b=(0,m.Z)(y,i,a,!1,null,null,null),g=b.exports},86558:function(t,e,s){s.d(e,{Z:function(){return f}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"flex mb-8 mt-6 rtl-space-x-reverse"},[s("squircle-button",{staticClass:"t-asset_action_row-receive w-1/5",attrs:{disabled:!t.isAssetReceivable&&!t.allowGeneralActions,icon:"icon-arrow_down",text:t.$t("general.receive")},on:{click:t.goToReceive}}),s("squircle-button",{staticClass:"t-asset_action_row-send w-1/5",attrs:{disabled:!t.isAssetSendable&&!t.allowGeneralActions||!t.hasSendableAssets,icon:"icon-arrow_right_up",text:t.$t("general.send")},on:{click:t.goToSend}}),s("squircle-button",{staticClass:"t-asset_action_row-swap w-1/5",attrs:{disabled:!t.isAssetSwappable&&!t.allowGeneralActions||!t.hasSwappableAssets,icon:"icon-swap",loading:!t.isSwapReady,text:t.$t("general.swap")},on:{click:t.goToSwap}}),s("squircle-button",{staticClass:"t-asset_action_row-buy w-1/5",attrs:{disabled:!t.isAssetBuyable&&!t.allowGeneralActions||!t.hasBuyableAssets,icon:"icon-buy",text:t.$t("general.buy")},on:{click:t.goToBuy}}),s("squircle-button",{staticClass:"t-asset_action_row-sell w-1/5",attrs:{disabled:!t.isAssetSellable&&!t.allowGeneralActions||!t.hasSellableAssets,icon:"icon-arrow_down",text:t.$t("general.sell"),transform:"scale(1,-1)"},on:{click:t.goToSell}})],1)},a=[],n=(s(57658),s(39765)),r=s(70794),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"flex flex-col items-center t-squirce_button-click",class:[{"opacity-40":t.disabled&&!t.loading,"cursor-not-allowed":t.unavailable}],on:{click:function(e){!t.unavailable&&t.$emit("click")}}},[s("button",{staticClass:"bg-contain bg-squircle-desktop flex h-12 items-center justify-center mb-2 w-12",class:[{"pointer-events-none":t.unavailable}]},[t.loading?s("spinning-loader",{staticClass:"mb-6 w-5"}):s("i",{staticClass:"text-black",class:t.icon,style:{transform:t.transform}})],1),s("span",{staticClass:"font-bold text-dark-N60 text-xs tracking-wide"},[t._v(t._s(t.text))])])},l=[],c=s(25e3),h={name:"SquircleButton",components:{SpinningLoader:c.Z},props:{disabled:{default:!1,type:Boolean},icon:{default:"",type:String},loading:{default:!1,type:Boolean},text:{default:"",type:String},transform:{default:"",type:String}},computed:{unavailable(){return this.disabled||this.loading}}},d=h,u=s(1001),p=(0,u.Z)(d,o,l,!1,null,null,null),v=p.exports,y=s(56258),m=s(20144),b=m.Z.extend({name:"AssetActionRow",components:{SquircleButton:v},props:{address:{default:"",type:String},token:{default:void 0,type:Object}},computed:{allowGeneralActions(){return"TokenOverview"!==this.$route.name},chain(){return this.token.chain},hasBuyableAssets(){return!!this.$store.getters.buyableTokens.length&&!this.isAssetTestnet},hasSellableAssets(){return!!this.$store.getters.sellableTokens.length&&!this.isAssetTestnet},hasSendableAssets(){return this.$store.getters.ownedTokens.some((t=>new r.Z(t.balance??0).isGreaterThan(0)))},hasSwappableAssets(){return!!this.swappableTokenFallback&&!this.isAssetTestnet},isAssetBuyable(){return this.$store.getters.isBuyable(this.chain,this.address)},isAssetReceivable(){return this.ownsAsset},isAssetSellable(){return this.$store.getters.isSellable(this.chain,this.address)&&new r.Z(this.token.balance).isGreaterThan(0)},isAssetSendable(){return this.ownsAsset&&new r.Z(this.token.balance).isGreaterThan(0)},isAssetSwappable(){return this.swapAddress&&this.$store.getters.isTokenSwappable(this.swapAddress,this.chain)},isAssetTestnet(){return this.$store.getters.isTestnet(this.chain)},isSwapReady(){return this.$store.getters.isSwapReady},ownsAsset(){return!!this.$store.getters.getTokenViaSerializedKey(this.address,this.chain)},sendableTokenFallback(){return this.$store.getters.ownedTokens.find((t=>new r.Z(t.balance??0).isGreaterThan(0)))},swapAddress(){return this.address===n.L1?n.NA:this.address},swappableTokenFallback(){return this.$store.getters.primarySwappableToken}},methods:{getStatsEventName(t){return"Overview"===this.$route.name?`wt_${t}_btn`:"Assets"===this.$route.name?`wt_asset_${t}`:"TokenOverview"===this.$route.name?`wt_coin_${t}`:""},goToBuy(){this.sendStats("buy"),this.$router.push({name:"Buy",params:{token:this.token}})},goToReceive(){this.sendStats("receive"),this.$router.push({name:"ReceiveToken",params:{token:this.token}})},goToSell(){const t=this.isAssetSellable?this.token:this.$store.getters.sellableTokens[0];this.sendStats("sell"),this.$router.push({name:"Sell",params:{token:t}})},goToSend(){const t=this.isAssetSendable?this.token:this.sendableTokenFallback;this.sendStats("send"),this.$router.push({name:"SendToken",params:{token:t}})},goToSwap(){const t=this.isAssetSwappable?this.token:this.swappableTokenFallback;this.sendStats("swap"),this.$router.push({name:"Swap",query:{chain:JSON.stringify(t.chain),from:t.address??this.swapAddress}})},sendStats(t){const e=this.token.symbol??this.token.contract?.symbol,s=this.getStatsEventName(t);"TokenOverview"===this.$route.name?y.Z.sendStatsEvent(y.Z.types.CLICK,s,{coin:e,network:this.$store.getters.getNetworkName(this.chain)}):y.Z.sendStatsEvent(y.Z.types.CLICK,s)}}}),g=b,w=(0,u.Z)(g,i,a,!1,null,"1d983151",null),f=w.exports},27176:function(t,e,s){t.exports=s.p+"img/complete_big.7b89d131.svg"},71643:function(t,e,s){t.exports=s.p+"img/in_progress_big.1c0baf16.svg"}}]);