"use strict";(self["webpackChunkdesktop_wallet"]=self["webpackChunkdesktop_wallet"]||[]).push([[862],{28862:function(e,t,r){r.r(t),r.d(t,{default:function(){return m}});var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"add-network-view flex flex-col px-14"},[r("top-bar",{staticClass:"-mx-14",attrs:{title:e.$t("views.networksView.addNetwork")}}),r("div",{staticClass:"before:absolute before:bg-status-warning before:block before:h-full before:left-0 before:opacity-15 before:rounded-lg before:top-0 before:w-full mb-8 mt-9 p-4 relative text-status-warning text-xs"},[e._v(" "+e._s(e.$t("views.networksView.addNetworkWarning"))+" ")]),r("network-form",{staticClass:"flex-grow",on:{networkFormCancelled:e.back,networkFormConfirmed:e.addNetworkConfirmed}}),r("multi-purpose-popup",{ref:"newNetworkPopup"})],1)},o=[],i=r(72294),s=r(2714),a=r(43941),l=r(53103),c=r(75619),u=r(20144),d=r(25108),p=u.Z.extend({name:"AddNetwork",components:{MultiPurposePopup:a.Z,NetworkForm:l.Z,TopBar:c.Z},data(){return{customChainInfo:null}},computed:{newNetworkPopup(){return this.$refs.newNetworkPopup}},methods:{async addNetworkConfirmed(e){this.setUpChainInfoPayload(e);const t=this.newNetworkPopup;t.show({description:this.$t("components.popovers.savingChanges"),popupType:"loader"}),await this.$store.dispatch("addCustomChain",this.customChainInfo).then((e=>{if(!e)return Promise.reject(new Error("Unknown error"));{this.fetchTokensForChain(this.customChainInfo?.chain);const e=this.$t("general.network");t.show({cancelButtonTitle:this.$t("views.networksView.popupCancelButtonTitle"),confirmButtonTitle:this.$t("views.networksView.addToken"),description:this.$t("views.networksView.successfullyAddedPopupDescription",{type:e}),popupType:"success",title:this.$t("views.networksView.successfullyAddedPopupTitle",{type:e})}),t.$once("popupCancelled",this.back),t.$once("popupConfirmed",(()=>this.addTokenRedirect(this.customChainInfo?.chain)))}})).catch((r=>{d.error(`Error during custom chain create/update ${e.chainName}: ${r}`);const n=r.toString().indexOf("Failed to connect")>=0&&this.$t("errors.connection.connectionError");n||this.$errorReporter.reportError(r,{extraData:{chain:e.chain}}),t.show({description:n||this.$t("views.networksView.addNetworkFailure"),popupType:"error",title:this.$t("errors.generic.oops")})}))},async addTokenRedirect(e){const t=this.newNetworkPopup;t.show({popupType:"loader"}),await this.$router.replace({name:"AddToken",query:{chain:JSON.stringify(e)}}),t.close()},back(){this.$router.back()},async fetchTokensForChain(e){await this.$store.dispatch("getTokensForChain",{chain:e,type:s.i.NATIVE})},setUpChainInfoPayload(e){const t={chainId:e.chainId,coinType:i.Dc.DEFAULT};this.customChainInfo={blockExplorerUrl:e.blockExplorerUrl,chain:t,chainName:e.name,nativeCurrency:{chain:t,symbol:e.symbol},rpcUrls:[e.rpcUrl]}}}}),h=p,w=r(1001),f=(0,w.Z)(h,n,o,!1,null,null,null),m=f.exports},53103:function(e,t,r){r.d(t,{Z:function(){return f}});var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"flex flex-col flex-grow network-form"},[e._l(e.formFieldsConfig,(function(t){return r("opera-input",e._b({key:"network-form-field-"+t.name,staticClass:"mb-8",attrs:{disabled:t.disabled,label:t.label,name:t.name,optional:t.optional,placeholder:t.label},on:{input:e.validate},model:{value:e.network[t.name],callback:function(r){e.$set(e.network,t.name,r)},expression:"network[field.name]"}},"opera-input",Object.assign({},e.showError(t.name)),!1))})),r("div",{staticClass:"flex-grow"}),r("div",{staticClass:"flex justify-between mb-10"},[r("outlined-button",{staticClass:"w-44",attrs:{title:e.$t("general.cancel")},on:{click:e.cancelNetworkForm}}),r("primary-button",{staticClass:"w-44",attrs:{disabled:e.formInvalid,title:e.$t("general."+(e.networkUpdate?"save":"add"))},on:{click:e.confirmNetworkForm}})],1)],2)},o=[],i=r(85512),s=r(70794),a=r(17482),l=r(89504),c=r(68461),u=r(20144),d=u.Z.extend({name:"NetworkForm",components:{OperaInput:a.Z,OutlinedButton:l.Z,PrimaryButton:c.Z},props:{networkDetails:{default:null,type:Object}},data(){return{error:{},formInvalid:!1,network:{blockExplorerUrl:"",chainId:null,name:"",rpcUrl:"",symbol:""}}},computed:{existingNetworks(){return this.$store.getters.allNetworks},formFieldsConfig(){return[{label:this.$t("general.networkName"),name:"name"},{label:this.$t("general.rpcUrl"),name:"rpcUrl"},{disabled:this.networkUpdate,label:this.$t("general.chainId"),name:"chainId"},{label:this.$t("general.symbol"),name:"symbol",optional:!0},{label:this.$t("general.blockExplorerUrl"),name:"blockExplorerUrl",optional:!0}]},networkFormFields(){const{$children:e}=this;return e.filter((({$options:e})=>e._componentTag.includes("opera-input")))},networkUpdate(){return null!==this.networkDetails}},watch:{error:{deep:!0,handler(e){this.formInvalid=!!Object.values(e).length}},networkDetails:{deep:!0,handler(e){e&&this.setInitialValues()}}},methods:{cancelNetworkForm(){this.$emit("networkFormCancelled")},confirmNetworkForm(){if(this.validateAll()){const{network:e}=this;e.chainId=new s.Z(e.chainId).toNumber(),this.$emit("networkFormConfirmed",e)}},setInitialValues(){this.network={...this.networkDetails}},showError(e){return e in this.error?{error:this.error[e],icon:"icon-error"}:null},validate(e,t){const{target:r}=t,{name:n}=r;let o={...this.error};const i=this.validator(n,e);i.fieldIsValid?delete o[n]:o=Object.assign({},o,{[n]:i.message}),this.error=o},validateAll(){const e={},t=this.networkFormFields;return t.forEach((({name:t,value:r})=>{const n=this.validator(t,r);n.fieldIsValid||(e[t]=n.message)})),this.error=e,!Object.entries(this.error).length},validator(e,t){let r,n,o=!0;const s=e=>this.$t("errors.generic.incorrectField",{fieldName:e});switch(e){case"name":o=!!t,r=s(this.$t("general.networkName"));break;case"rpcUrl":o=i.wC(t),r=s(this.$t("general.rpcUrl"));break;case"chainId":if(o=i.JW(t),!this.networkUpdate&&(n=this.existingNetworks.find((({chain:e})=>e.chainId===Number.parseInt(t))),n)){o=!1,r=this.$t("errors.networkAlreadyExists",{networkName:n.name});break}r=s(this.$t("general.chainId"));break;case"symbol":o=!t||!!t&&i.HA(t),r=s(this.$t("general.symbol"));break;case"blockExplorerUrl":o=!t||!!t&&i.Ff(t),r=s(this.$t("general.blockExplorerUrl"));break;default:o=!0,r=""}return{fieldIsValid:o,message:r}}}}),p=d,h=r(1001),w=(0,h.Z)(p,n,o,!1,null,null,null),f=w.exports},85512:function(e,t,r){r.d(t,{Ff:function(){return h},HA:function(){return p},JW:function(){return u},Ze:function(){return d},wC:function(){return c},xP:function(){return a}});var n=r(70794),o=r(38531),i=r.n(o);function s(e){return(0,n.Z)(e)}function a(e){return s(e).isPositive()}function l(e){return/^(https?):\/\/.+$/.test(e)}function c(e){return/^(|wss?):\/\/.+$/.test(e)||l(e)}function u(e){const t=s(e);return t.isInteger()&&t.isPositive()}function d(e){return i().validate(e,"ETH")}function p(e){return/^[a-zA-Z]+$/.test(e)}function h(e){return l(e)}}}]);